---
title: redis

categories:
- redis

tags:
- 数据库
---

redis
开源的(bsd协议), 使用ansi c编写, 基于内存的且支持持久化, 高性能key-value的nosql数据库.
支持数据结构类型丰富, 有如字符串(strings), 散列(hashes), 列表(lists), 集合(sets), 有序集合(sorted) 与范围查询, bitmaps, hyperloglogs和地理空间(geospatial)索引半径查询.
丰富的支持主流语言的客户端, c, c++, python, erlang, r
用途: 缓存, 数据库, 消息中间件



redis 有基本的数据结构
string: 字符串
hash: 哈希
list: 列表
set: 集合
sorted set: 有序集合

redis数据模型
redis支持数据模型非常丰富

键key
redis key需要一个二进制值, 可以用任何二进制序列作为key值, 可以是简单字符串, 也可以是个Jpeg文件的二进制序列. 空字符串也是有效key值.

key取值原则
键值不需要太长, 消耗内存, 而且查找这类键值的计算成本比较高.
键值不宜过短, 可读性较差.
习惯上key采用'user:123:password'形式, 表示用户id为123的用户的密码.

字符串
字符串是一种最基本简单的redis值类型.说是字符串, 其实可以是任意可以序列化的数据.一个字符串类型的值最多能存512M字节的内容.


位图bitmap
位图不是真正的数据类型, 它是定义在字符串类型上, 只不过把字符串按位操作
一个字符串类型的值最多能存512M字节的内容, 可以表示2^32位.

list列表
- 其列表是基于双向链表实现, 列表头尾增删快, 中间增删慢.
- 元素是字符串类型
- 元素可以重复出现
- 索引支持正索引和负索引, 从左至右开始, 从右至左-1开始

hash散列
值是field和value组成的map键值对
field和value都是字符串类型
hash用途
节约内存空间
没创建一个键, 它都会为这个键存储一些附加的管理信息(比如这个键的类型, 这个键最后一次被访问的时间等等)
所以数据库里面的键越多, redis数据库服务器在存储附加管理信息方面耗费的内存就越多, 花在管理数据库键上的cpu时间也会越多.


set集合
集合的元素是无序的, 去重的, 元素是字符串类型

sortedset 有序集合

类似set集合, 有序的集合.
每一个元素都关联着一个浮点数分值, 并按照分值从小到大的顺序排列集合中和元素.分值可以相同.

redis 持久化
持久化: 将数据从掉电易失的内存放到能够永久存储的设备上,
redis服务是使用内存来存储数据, 如果掉电, 服务崩溃都会导致redis数据丢失, 如有必要, 可以持久化数据.
redis持久化方式: rdb(redis db), aof(appendOnlyFile)
RDB
在默认情况下, redis将某时间点的数据库快照保存在名字为dump.rdb的二进制文件中.

策略
- 自动: 按照配置文件中的条件满足就执行BGSAVE
- 自动: 客户端发起save, Bgsave命令


优点
- 完全备份, 不同时间的数据集备份可以做到多版本恢复
- 紧凑的单一文件, 方便网络传输, 适合灾难恢复
- 快照文件直接恢复, 大数据集速度比AOF快些

缺点
- 会丢失最近写入, 修改的而未能持久化的数据
- folk过程比较耗时, 会造成毫秒级不能响应客户端请求

rdb备份策略
创建一个定时任务cron job, 每一个或者每天将dump.rdb